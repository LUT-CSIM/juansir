# AGENTS.md

## 1. 系统数据结构与核心Agent说明

本系统用于公路病害无人机巡检的数据采集、标注、统计、报表与多媒体管理，核心数据Agent如下：

| Agent（模型）    | 主要功能与说明                                            | 主要关联字段/外键                                    |
| ---------------- | --------------------------------------------------------- | ---------------------------------------------------- |
| DiseaseType      | 病害类型基础字典，所有检测结果、统计、报表均引用          | name, description                                    |
| WeatherType      | 天气类型基础字典，检测批次/报表/统计用                    | name, code                                           |
| SeverityLevel    | 病害严重度等级，支持运营自定义                            | name, code, description                              |
| ReportType       | 报表类型配置，支持不同业务场景的报表导出                  | name, code, description                              |
| MediaType        | 多媒体类型字典，图片、视频、附件等                        | name, code                                           |
| DetectionBatch   | 检测批次主表，关联飞行参数、无人机、机场、天气等          | weather, airport, drone_id                           |
| Report           | 检测报表主表，关联检测批次和类型，可存储生成历史/文件链接 | batch, report_type, file_link                        |
| DefectTrack      | 单个病害跟踪记录，关联批次、类型、严重度、截图等          | batch, disease_type, severity, report, snapshot_link |
| DiseaseMedia     | 病害相关媒体（如截图、视频），支持多媒体挂接              | defect_track, media_type, file_link                  |
| GroundTruthFrame | 病害在每一帧的标注信息，含时空、位置信息                  | track, frame_index, time, bbox_x/y/w/h               |

**所有Agent间的关联关系均为外键，详见 models.py 文件定义。**

---

## 2. 各Agent/模型功能定位

- **DiseaseType / WeatherType / SeverityLevel / ReportType / MediaType**
  - 均为**动态可维护的基础数据表**，由运营后台灵活配置，前端/接口层用外键实现选项联动，便于业务灵活扩展。
- **DetectionBatch**
  - 无人机检测主批次，记录飞行参数、时间、机场、视频、天气等。是病害数据与报表统计的基础入口。
- **Report**
  - 每次检测、统计分析、报表导出等均以此为载体。可附带下载链接、内容概述。
- **DefectTrack**
  - 每个病害（如裂缝、坑槽等）单独编号，跟踪其在检测视频中的发展与定位，支持严重度、趋势描述、截图等。
- **DiseaseMedia**
  - 支持为任意病害挂接截图、视频、相关报告等多媒体资源。类型由 MediaType 表动态定义。
- **GroundTruthFrame**
  - 每个病害跟踪在视频各帧的空间位置、时间戳与标注信息，支撑后续智能分析与回溯。

---

## 3. 字段动态扩展与运维说明

- 所有原本为 choices 的字段均已抽象为独立基础表（如天气、严重度、报表类型等）。
- 后台运营或管理端可随时**增加、修改、禁用各选项**，接口层不需变更代码。
- 便于适应未来业务迭代、区域定制、标准升级等需求。

---

## 4. 关键业务流程与数据流

**（1）日常检测与报表生成**

- 运营人员录入 DetectionBatch，选择机场、无人机、天气、飞行时间等。
- 检测结果自动/人工标注后生成 DefectTrack 与 GroundTruthFrame 记录。
- 支持自动/人工生成检测报表（Report），可直接附带多媒体截图（DiseaseMedia）。
- 每个病害都可以附带多种类型的媒体资料，方便后续复查与归档。

**（2）多频次/多架次/多机场统计**

- DetectionBatch 支持多架次、同一天多次飞行等复杂场景管理。
- 可据需统计各机场、无人机、天气、严重度等维度下的业务指标。

**（3）历史数据归档与回溯**

- 所有批次、报表、病害数据都带有归档/过期标记，便于历史数据查询与定期归档。
- 支持对历史病害的多维检索、趋势分析与视频回放。

**（4）视频与多媒体资料管理**

- 视频文件、截图等均通过 DiseaseMedia 统一管理和归档。
- 支持按批次、病害类型、严重度等任意维度检索和下载。

---

## 5. 可扩展性与二次开发建议

- **字段、业务流程、接口均支持高度定制化，未来如需接入更多设备/类型/业务可直接扩展基础数据表即可。**
- 推荐结合 Django admin 做基础表维护，结合 DRF 实现灵活接口（含多表联合查询）。
- 支持后续自动报表生成、AI 检测算法、复杂运营统计等高级功能无缝集成。

---

## 编码要求

同步对应的readme.md文件
